# ü§ñ Brocconi: AI-Powered PDF OCR CLI üìö

[![Node.js](https://img.shields.io/badge/Node.js-%23339933.svg?style=for-the-badge&logo=node.js&logoColor=white)](https://nodejs.org/)
[![Bun](https://img.shields.io/badge/Bun-%23000000.svg?style=for-the-badge&logo=bun&logoColor=white)](https://bun.sh/)
[![TypeScript](https://img.shields.io/badge/typescript-%23007ACC.svg?style=for-the-badge&logo=typescript&logoColor=white)](https://www.typescriptlang.org/)
[![Prettier](https://img.shields.io/badge/prettier-%23F7B93E.svg?style=for-the-badge&logo=prettier&logoColor=black)](https://prettier.io/)
[![ESLint](https://img.shields.io/badge/eslint-%234A154B.svg?style=for-the-badge&logo=eslint&logoColor=white)](https://eslint.org/)
[![MIT License](https://img.shields.io/badge/License-MIT-yellow.svg)](https://opensource.org/licenses/MIT)
[![Maintenance](https://img.shields.io/badge/Maintained%3F-yes-green.svg)](https://GitHub.com/ragaeeb/brocconi/graphs/commit-activity)
[![Build Status](https://img.shields.io/github/actions/workflow/status/ragaeeb/brocconi/build.yml?branch=main)](https://github.com/ragaeeb/brocconi/actions/workflows/build.yml)
[![wakatime](https://wakatime.com/badge/user/a0b906ce-b8e7-4463-8bce-383238df6d4b/project/3825fe86-83bd-4da7-9d1e-1fa20e21023b.svg)](https://wakatime.com/badge/user/a0b906ce-b8e7-4463-8bce-383238df6d4b/project/3825fe86-83bd-4da7-9d1e-1fa20e21023b)
[![Node.js CI](https://github.com/ragaeeb/brocconi/actions/workflows/build.yml/badge.svg)](https://github.com/ragaeeb/brocconi/actions/workflows/build.yml)
![GitHub License](https://img.shields.io/github/license/ragaeeb/brocconi)
![GitHub Release](https://img.shields.io/github/v/release/ragaeeb/brocconi)
![typescript](https://badgen.net/badge/icon/typescript?icon=typescript&label&color=blue)
![Types](https://img.shields.io/npm/types/brocconi)
![CodeRabbit Pull Request Reviews](https://img.shields.io/coderabbit/prs/github/ragaeeb/brocconi?utm_source=oss&utm_medium=github&utm_campaign=ragaeeb%2Fbrocconi&labelColor=171717&color=FF570A&link=https%3A%2F%2Fcoderabbit.ai&label=CodeRabbit+Reviews)
![Node & Bun](https://img.shields.io/badge/Works%20with-Node%20%26%20Bun-green)
![Maintenance](https://img.shields.io/maintenance/yes/2025)
![npm](https://img.shields.io/npm/v/brocconi)
![npm](https://img.shields.io/npm/dm/brocconi)

[![Readme was generated by Dokugen](https://img.shields.io/badge/Built%20with-Dokugen-brightgreen)](https://github.com/samueltuoyo15/Dokugen)

A CLI for OCRing images using `Gemini AI` with `ocr.space` as a fallback. ‚ú®

## üõ†Ô∏è Installation

Get started with Brocconi in just a few steps:

- **Clone the Repository**:

    ```bash
    git clone git@github.com:ragaeeb/brocconi.git
    cd brocconi
    ```

- **Install Dependencies**:

    ```bash
    bun install
    ```

- **Build the project**:

    ```bash
    bun run build
    ```

## Installation

```bash
# Clone the repository
git clone https://github.com/ragaeeb/brocconi.git
cd brocconi

# Install dependencies
bun install

# Link the command globally (optional)
```

```bash
brocconi [options] <directory> [<directory2> ...]
```

## Prerequisites

This library uses `pdftoppm` to convert the PDF to images which can be used for OCR. Ensure you have `pdftoppm` installed.

You can download it using homebrew:

```bash
brew install poppler
pdftoppm -v
```

## üöÄ Usage

### Set API keys

In order to make calls to the Gemini API, you need to have your API keys set. Get your [API keys](https://aistudio.google.com/app/apikey) from Google AI Studio. Then you can set it like this:

```bash
bunx brocconi -k "GEMINI_API_KEY"
```

To work around rate-limiting, you can also set multiple API keys:

```bash
bunx brocconi -k "GEMINI_API_KEY1 GEMINI_API_KEY2 GEMINI_API_KEY3"
```

At runtime, the app will pick a random one.

#### Set ocr.space API key

Sometimes Gemini fails to OCR the image. The app will retry with different models, but if it cannot succeed with any of them, it can fall back to using a different platform like ocr.space. If you want this fallback, you can get a ocr.space [key](https://ocr.space/ocrapi/freekey). Then set the key like this:

```bash
bunx brocconi -b "OCRSPACEKEY"
```

### OCR a PDF

```bash
bunx brocconi /path/to/file.pdf
```

This will process the PDF and output the results to `/path/to/file.json`.

### Specify output file

```bash
bunx brocconi /path/to/file.pdf -o ./outputFile.json
```

### Extract footnotes

This will do a best-effort to identify footnotes separate from the paragraph body text and include the footnote text in a `footnotes` property per page.

```bash
bunx brocconi /path/to/file.pdf -f
```

### Include Volume Number

If you have a multi-volume book, you can include the `part` number like this.

```bash
bunx brocconi /path/to/file.pdf -p 3
```

This will add `part: 3` for each page.

### Delete all uploads before starting

In case of errors, you might want to do a cleanup of all the previously uploaded files. You can run the reset command like this:

```bash
bunx brocconi /path/to/file.pdf -r
```

This will first delete all the files in your Gemini AI Studio, then start OCR. Be careful with this command, it deletes ALL the files in your Gemini AI Studio. Use cautiously! The author of this package is NOT responsible for you accidentally erasing your data.

## Method

`brocconi` works by turning the PDF into images, filtering out blank pages so we don't waste API calls, then giving Gemini an image with an expected output how the OCR results should behave (this is called the "training image"), then giving the actual page to OCR. This allows fine-tuning and improving accuracy of how to format the text back.

## ‚ú® Features

- ü§ñ **AI-Powered OCR**: Leverages advanced AI models for accurate text extraction.
- üìÑ **PDF to Text**: Converts PDFs into structured JSON output.
- ‚úÇÔ∏è **Footer Isolation**: Isolates footnotes for cleaner main text.
- üîë **API Key Management**: Easily configure and manage multiple API keys.
- ‚öôÔ∏è **Configurable**: Customize OCR behavior with various command-line flags.

## üõ†Ô∏è Technologies Used

| Technology                                | Link                                                                                     |
| :---------------------------------------- | :--------------------------------------------------------------------------------------- |
| Node.js                                   | [https://nodejs.org/](https://nodejs.org/)                                               |
| Bun                                       | [https://bun.sh/](https://bun.sh/)                                                       |
| Google Gemini API                         | [https://ai.google.dev/](https://ai.google.dev/)                                         |
| OCR Space API                             | [https://ocr.space/](https://ocr.space/)                                                 |
| catsa-janga (for progress saving)         | [https://www.npmjs.com/package/catsa-janga](https://www.npmjs.com/package/catsa-janga)   |
| sharp (for image processing)              | [https://sharp.pixelplumbing.com/](https://sharp.pixelplumbing.com/)                     |
| semantic-release (for release automation) | [https://semantic-release.org/](https://semantic-release.org/)                           |
| eslint/prettier                           | [https://eslint.org/](https://eslint.org/), [https://prettier.io/](https://prettier.io/) |

## ü§ù Contributing

Want to help improve Brocconi? Here's how:

- üêõ **Report Bugs**: Submit detailed bug reports to help us squash those pesky critters.
- ‚ú® **Suggest Enhancements**: Share your ideas for new features and improvements.
- üíª **Submit Pull Requests**: Contribute code fixes and new features (see guidelines below).

### Contribution Guidelines

1.  Fork the repository.
2.  Create a new branch for your feature or bug fix.
3.  Write clear, maintainable code.
4.  Include tests for your changes.
5.  Submit a pull request with a detailed description of your changes.

## üìú License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## Author Info

- Ragaeeb Haq
- [https://github.com/ragaeeb](https://github.com/ragaeeb)
